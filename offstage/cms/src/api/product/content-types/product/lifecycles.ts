const {uid} = require('uid/secure');

const cmsIdPrefix = 'pr';

export default {
  beforeCreate(event) {
    // Autogenerated data
    event.params.data.cmsId = `${cmsIdPrefix}-${uid(6)}`;

    // Field cleanup
    const {summary, slug, name} = event.params.data;
    event.params.data.name = name.trim();
    event.params.data.summary = summary?.trim() || null;
    event.params.data.slug = slug?.trim() || null;
  },

  async beforeUpdate(event) {
    const {cmsId, summary, slug, name} = event.params.data;

    // Autogenerated data
    if (!cmsId) {
      event.params.data.cmsId = `${cmsIdPrefix}-${uid(6)}`; // Set cmsId
    }

    // Field cleanup
    event.params.data.name = name?.trim() || null;
    event.params.data.summary = summary?.trim() || null;
    event.params.data.slug = slug?.trim() || null;
  },
};
